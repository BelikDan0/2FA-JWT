<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–í—Ö–æ–¥</title>
</head>
<body>

<h2>–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h2>

<input id="username" placeholder="–õ–æ–≥–∏–Ω"><br><br>
<input id="password" type="password" placeholder="–ü–∞—Ä–æ–ª—å"><br><br>

<button onclick="login()">–í–æ–π—Ç–∏</button>

<p id="error" style="color:red;"></p>

<script>
  async function login() {
    const res = await fetch("/api/auth", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({
        username: username.value,
        password: password.value
      })
    });

    if (!res.ok) {
      document.getElementById("error").innerText = "–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞";
      return;
    }

    const data = await res.json();

    // üîê –º–µ—Å—Ç–æ –ø–æ–¥ JWT
    localStorage.setItem("token", data.token || "JWT_PLACEHOLDER");
    localStorage.setItem("role", data.role);

    // üîê –º–µ—Å—Ç–æ –ø–æ–¥ 2FA
    if (data.need2fa) {
      window.location.href = "/totp.html";
      return;
    }

    if (data.role === "ADMIN") {
      window.location.href = "/admin.html";
    } else {
      window.location.href = "/index.html";
    }
  }
</script>

</body>
</html>
